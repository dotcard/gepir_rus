# Как пользоваться?

Библиотека делалась под свои нужды, поэтому основной функционал — запрашивать реквизиты организации по GTIN, ИНН или другому коду, связанному с организацией. В examples.py есть пример функции, запрашивающей GLN по ИНН организации.

## Алгоритм запроса:
1. Создать экземпляр класса GepirClient.
2. Воспользоваться методом get_key_licensee, передав туда аббревиатуру кода и его значение.
3. Извлечь нужные реквизиты из поля `body.gepirParty` объекта, который вернёт функция.

# Плагины
Поскольку GEPIR в некоторых случаях возвращает XML не совсем по формату (к которому строг его предок zeep.Client), я написал пару плагинов, подгоняющих ответ под WSD:
* AdditionalPrefixesRemovePlugin — удаляет тег AdditionalPrefixes внутри partyDataLine, которого в описании формата нет нигде
* NoPartyDataLanguagePlugin — добавляет тег partyDataLanguage внутрь partyDataLine, когда его нет в ответе

Создавайте свои плагины под нестандартные ситуации или пишите мне.

# Кэширование
Данные о формате (WSD) раз в час кэшируются в файл cache.db. Один раз сервер не хотел отдавать формат со словами "Слишком много запросов", поэтому я на всякий случай задействовал кэш.

# Ограничения по количеству запросов
Насколько мне известно, GS1 разрешает запрашивать в день до 30 организаций. Если перевалите за это (или другое) ограничение, ответ будет с кодом 98, и нужно будет ждать завтра. Код ответа я не обрабатываю, так что придётся в отладке смотреть заголовок. Лучше ставить точку останова в одном из плагинов.

# Спасибо
Автору библиотеки zeep, которую я задействовал для взаимодействия с SOAP-интерфейсом. Единственная библиотека, корректно обрабатывающая WSD и способная объяснить, что ей не нравится в ответе от сервера.